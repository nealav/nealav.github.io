{"componentChunkName":"component---src-templates-blog-post-blog-post-js","path":"/blog/auth-preview-gatsby-contentful-netlify","result":{"data":{"markdownRemark":{"html":"<p>Learn how to setup a preview instance of your Gatsby site using the Contentful Preview API\nand authenticate it using Netlify Identity with Google OAuth.</p>\n<!-- end -->\n<ul>\n<li><a href=\"#introduction\">Introduction</a></li>\n<li><a href=\"#prerequisites\">Prerequisites</a></li>\n<li>\n<p><a href=\"#setup\">Setup</a></p>\n<ul>\n<li><a href=\"#gatsby\">Gatsby</a></li>\n<li><a href=\"#netlify\">Netlify</a></li>\n<li><a href=\"#contentful\">Contentful</a></li>\n</ul>\n</li>\n<li><a href=\"#testing\">Testing</a></li>\n<li><a href=\"#conclusion\">Conclusion</a></li>\n</ul>\n<h2 id=\"introduction\" style=\"position:relative;\"><a href=\"#introduction\" aria-label=\"introduction permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Introduction</h2>\n<p>Contentful provides a <a href=\"https://www.contentful.com/developers/docs/references/content-preview-api/\">Preview API</a> that returns unpublished content (e.g. draft blog posts) to allow users to preview this content on their website.</p>\n<p>Setting up a server to host an instance of your Gatsby website that uses the Preview API and is accessible within a local/corporate network is relatively trivial. In my case, I am working with a remote content creator; we do not work on the same network nor do I have a dedicated local network available for VPN access. Gatsby provides <a href=\"https://www.gatsbyjs.org/docs/authentication-tutorial/\">tutorials</a> on authenticating routes but in this case I want the entire website to be authenticated without having to re-create page routes.</p>\n<p>The solution I came up with is to run a preview instance on Netlify that uses <a href=\"https://www.netlify.com/docs/identity/\">Netlify Identity</a> for authentication and Netlify <a href=\"https://www.netlify.com/tags/deploy-contexts/\">Deploy Contexts</a> to ensure that the builds on a target branch use the Preview API and turn on authentication. <a href=\"https://www.contentful.com/developers/docs/concepts/webhooks/\">Contentful Webhooks</a> are used to trigger re-deploys on Netlify to ensure the preview website stays updated.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; margin: 1rem; max-width: 378px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/253f421c8389ffa2b4ed706a11f0ee89/1b718/login.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 116.89189189189189%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAABYlAAAWJQFJUiTwAAADT0lEQVQ4y61UW08TQRTub9AH0RgfNFE0gon6ZtSoMSb6QoyAUcAQDcWABk180AcfjMTERMEbSkRjfNVEDF4RKVBKuXgXEBAN11Zpu9t22+62u93PM7NtXaCgMU7yZeac850zZ86ZGcuFS1fx+OkLPHjUgIf1T9KggdsMe3oOs9U3PMfF6huwtDu78L+Gs/sNLE22Vi7EYjFomjYN0HWIfj/ef/qMnncfIIgi587kMV82WtudsLxusXPB5f6BiUkXJl1uTHC4uO77yCi63r7Dmw8fMTI6hknGS3A4N+HDhr2j63fAKO2iqipBM6BpXI7H46kjaQldiqMacjSRob2j0xQwOvvISRhB1Dnt0Wh0dsAprxej4xPwCSIHy+xvoFOd0waMyDIUReEFZlBNmf0JSrqAyWDRJIgUS9X1HwL6A0FMebz8ani8Pg6WNRvsWPMhbVNkypBnRTsmj53MmGXP7Sa9GYpiytDW1s6FijNnkX/YisLSchRYywyUlKGo9BiOHD+JkopTfH2wpCxlL7SWY//hUpSfOg2NGtTR2QNLi93B0964bRcWLM/EktXrkLEqGxmZ2Vi0MgvLsjZg8+4cbNmTg6Vr13MdszHOYuIuXLEG2Zu2QabyOLvo6TW3Gke205t+2dyCppY2vEqArRtJZ6NNm+kkjXPYWx1OHoP9C6kazjfCERlSKPxHnt1haoquscKqM8C6p8PrccPz05Vwi83iGb4zuvzNHUH/mIyvLoWjf1xGH8m9oxEMuTWOvrEIeknHbEne4KTCfU1dNgIW13iwr0rEjkofdpwXcOCaiOJbfhyq8aPgOluLKKL1kVpD3k6cnZUCtp4TkFc1BVUHdZlqaEs05cQ9D4pvisir9iGXYL0touyOgKN1AkrrjNl6W8DJ+6S/KyK3yof8KwL2XiZ97RTo9zQCJo8cCEUhSjFIERVBAlsHZR1hKo+kgM8MgbAOwcQLhhlMNWyytXEhrqm8AbQyXk4kjMGhQXzq7cXwt2GaP+PLwAAGSKfIyY7HuY/hC7Q5eA0dhknXp10BJrKrwr4yNgeCQQQlia5QhD+E6VxDdnR2w9LwrJG/R/Yp+AOBFAL0WUihEELhsDFT0BDNkhTiNjOX+bIYL5ts+AVSBmdyv5dT2gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Login screen\"\n        title=\"Login screen\"\n        src=\"/static/253f421c8389ffa2b4ed706a11f0ee89/1b718/login.png\"\n        srcset=\"/static/253f421c8389ffa2b4ed706a11f0ee89/c5084/login.png 148w,\n/static/253f421c8389ffa2b4ed706a11f0ee89/60cc9/login.png 295w,\n/static/253f421c8389ffa2b4ed706a11f0ee89/1b718/login.png 378w\"\n        sizes=\"(max-width: 378px) 100vw, 378px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>To summarize the changes:</p>\n<ul>\n<li>\n<p>Wrap Gatsby's root element in a higher-order component that uses Netlify Identity to check if the user is logged in</p>\n<ul>\n<li>If the user isn't logged in, redirect to a login screen</li>\n</ul>\n</li>\n<li>Add support for environment variables to force builds to use the Contentful Preview API</li>\n<li>Create a deploy context on Netlify for the target branch (e.g. <code class=\"language-text\">develop</code> or <code class=\"language-text\">preview</code>) that sets environment variables</li>\n<li>Add a webhook to Contentful to trigger re-deploys for the target branch deploy context</li>\n</ul>\n<h2 id=\"prerequisites\" style=\"position:relative;\"><a href=\"#prerequisites\" aria-label=\"prerequisites permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Prerequisites</h2>\n<p>This post will not cover how to set this up from scratch.</p>\n<p>There are some prerequisites:</p>\n<ul>\n<li>\n<p><a href=\"https://gatsbyjs.org\">Gatsby</a> + <a href=\"https://contentful.com\">Contentful</a> project</p>\n<ul>\n<li>I recommend using <a href=\"https://github.com/contentful-userland/gatsby-contentful-starter\">the starter</a></li>\n</ul>\n</li>\n<li><a href=\"https://netlify.com\">Netlify</a> site linked to the project</li>\n</ul>\n<p>There are plenty of good resources online (<a href=\"https://www.contentful.com/r/knowledgebase/gatsbyjs-and-contentful-in-five-minutes/\">1</a>, <a href=\"https://itnext.io/jamstack-basics-how-to-create-a-gatsby-starter-with-contentful-and-deploy-to-netlify-846354cc74bc\">2</a>) you can use to learn how to set this up.</p>\n<h2 id=\"setup\" style=\"position:relative;\"><a href=\"#setup\" aria-label=\"setup permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setup</h2>\n<h3 id=\"gatsby\" style=\"position:relative;\"><a href=\"#gatsby\" aria-label=\"gatsby permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Gatsby</h3>\n<p>We can create a wrapper service for <code class=\"language-text\">netlify-identity-widget</code> that our application can use to check if the user is authenticated and allow the user to login.</p>\n<p>First, install it as a dependency via <code class=\"language-text\">npm i -S netlify-identity-widget</code>.</p>\n<p><code class=\"language-text\">auth.js</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> netlifyIdentity <span class=\"token keyword\">from</span> <span class=\"token string\">'netlify-identity-widget'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// `window` won't be defined on SSR builds</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> window <span class=\"token operator\">!==</span> <span class=\"token string\">'undefined'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  netlifyIdentity<span class=\"token punctuation\">.</span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  window<span class=\"token punctuation\">.</span>netlifyIdentity <span class=\"token operator\">=</span> netlifyIdentity<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n  isAuthenticated<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">authenticate</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">callback</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>isAuthenticated <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n    netlifyIdentity<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    netlifyIdentity<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'login'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">user</span> <span class=\"token operator\">=></span> <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">currentUser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> netlifyIdentity<span class=\"token punctuation\">.</span><span class=\"token function\">currentUser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Next, we create a higher-order component that we can use to wrap page components.</p>\n<p><code class=\"language-text\">withAuth.js</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> PureComponent <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> auth <span class=\"token keyword\">from</span> <span class=\"token string\">'./auth'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// We can check this before the component is rendered.</span>\n<span class=\"token keyword\">const</span> alreadyLoggedIn <span class=\"token operator\">=</span> auth<span class=\"token punctuation\">.</span>isAuthenticated\n<span class=\"token operator\">||</span> auth<span class=\"token punctuation\">.</span><span class=\"token function\">currentUser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">withAuth</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">PageComponent</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">WithAuthPageComponent</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">PureComponent</span> <span class=\"token punctuation\">{</span>\n    state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      isLoggedIn<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n      redirectPath<span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">componentDidMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// When it's first mounted, store the path name.</span>\n      <span class=\"token comment\">// This allows us to redirect to it after the user has logged in.</span>\n      <span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>pathname<span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        redirectPath<span class=\"token operator\">:</span> <span class=\"token operator\">!</span>alreadyLoggedIn <span class=\"token operator\">&amp;&amp;</span> path <span class=\"token operator\">!==</span> <span class=\"token string\">'/'</span>\n          <span class=\"token operator\">?</span> path\n          <span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function-variable function\">login</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> auth<span class=\"token punctuation\">.</span><span class=\"token function\">authenticate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">user</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n          isLoggedIn<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n        isLoggedIn<span class=\"token punctuation\">,</span>\n        redirectPath<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>isLoggedIn <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span>alreadyLoggedIn<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n          <span class=\"token operator\">&lt;</span>button\n            type<span class=\"token operator\">=</span><span class=\"token string\">\"button\"</span>\n            onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>login<span class=\"token punctuation\">}</span>\n            <span class=\"token comment\">// This will center the button vertically</span>\n            <span class=\"token comment\">// and horizontally. You don't need to do this necessarily.</span>\n            style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\n              left<span class=\"token operator\">:</span> <span class=\"token string\">'50%'</span><span class=\"token punctuation\">,</span>\n              top<span class=\"token operator\">:</span> <span class=\"token string\">'50%'</span><span class=\"token punctuation\">,</span>\n              transform<span class=\"token operator\">:</span> <span class=\"token string\">'translate(-50%, -50%)'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n          <span class=\"token operator\">></span>\n            <span class=\"token constant\">LOGIN</span>\n          <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>redirectPath<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        window<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span>redirectPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n        <span class=\"token operator\">&lt;</span>PageComponent <span class=\"token punctuation\">{</span><span class=\"token operator\">...</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now, we can create the function to do the wrapping (based on an environment variable -- we'll cover that after).</p>\n<p><code class=\"language-text\">wrapRootElementWithAuth.js</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> PropTypes <span class=\"token keyword\">from</span> <span class=\"token string\">'prop-types'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> withAuth <span class=\"token keyword\">from</span> <span class=\"token string\">'./withAuth'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> useAuth <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">ENABLE_NETLIFY_AUTH</span> <span class=\"token operator\">===</span> <span class=\"token string\">'true'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">wrapRootElement</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span>\n  element<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">RootElement</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>React<span class=\"token punctuation\">.</span>Fragment<span class=\"token operator\">></span>\n      <span class=\"token punctuation\">{</span>element<span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>React<span class=\"token punctuation\">.</span>Fragment<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>useAuth<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>RootElement <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> ElementWithAuth <span class=\"token operator\">=</span> <span class=\"token function\">withAuth</span><span class=\"token punctuation\">(</span>RootElement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>ElementWithAuth <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\nwrapRootElement<span class=\"token punctuation\">.</span>propTypes <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  element<span class=\"token operator\">:</span> PropTypes<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>isRequired<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> wrapRootElement<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Now, we need to do the element wrapping via Gatsby's <a href=\"https://www.gatsbyjs.org/docs/browser-apis/\">Browser APIs</a> and <a href=\"https://www.gatsbyjs.org/docs/node-apis/\">Node APIs</a>. We can use <code class=\"language-text\">wrapRootElement</code> specifically.</p>\n<p><code class=\"language-text\">gatsby-browser.js</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> wrapRootElementWithAuth <span class=\"token keyword\">from</span> <span class=\"token string\">'./src/auth/wrapRootElementWithAuth'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> wrapRootElement <span class=\"token operator\">=</span> wrapRootElementWithAuth<span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">gatsby-node.js</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> wrapRootElementWithAuth <span class=\"token keyword\">from</span> <span class=\"token string\">'./src/auth/wrapRootElementWithAuth'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> wrapRootElement <span class=\"token operator\">=</span> wrapRootElementWithAuth<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Now, we need to add support for <code class=\"language-text\">ENABLE_NETLIFY_AUTH</code>. Since we're using it on the client-side, we need to make it accessible to\nmodules. This can be accomplished with <a href=\"https://www.gatsbyjs.org/packages/gatsby-plugin-env-variables/\"><code class=\"language-text\">gatsby-plugin-env-variables</code></a>.</p>\n<p>After installing it as a dependency (<code class=\"language-text\">npm i -S gatsby-plugin-env-variables</code>), add the following lines to your <code class=\"language-text\">gatsby-config.js</code> file:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token operator\">...</span>\nplugins<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n  resolve<span class=\"token operator\">:</span> <span class=\"token string\">'gatsby-plugin-env-variables'</span><span class=\"token punctuation\">,</span>\n  options<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Variables in the whitelist will be available to builds as process.env.&lt;NAME>, just</span>\n    <span class=\"token comment\">// like Node processes</span>\n    whitelist<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">'ENABLE_NETLIFY_AUTH'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token operator\">...</span></code></pre></div>\n<p>Now, we must add environment variable support to switch to the Contentful Preview API.</p>\n<p>Let's name this variable <code class=\"language-text\">CONTENTFUL_USE_PREVIEW</code>.</p>\n<p>With <code class=\"language-text\">gatsby-source-contentful</code>, there is a <code class=\"language-text\">host</code> option we can use. I moved plugin options to their own module for encapsulation.</p>\n<p><strong>NOTE: You will need both Preview and Delivery API tokens setup in your build environment.</strong></p>\n<p><code class=\"language-text\">contentful-options.js</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// We can use dotenv to read environment variables from a file (e.g. local environment).</span>\n<span class=\"token comment\">// This is not required if you don't want to preview locally.</span>\n<span class=\"token comment\">// This does require you to install it as a dependency:</span>\n<span class=\"token comment\">//  `npm i -S dotenv`</span>\n<span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'dotenv'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  path<span class=\"token operator\">:</span> <span class=\"token string\">'.env'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token constant\">CONTENTFUL_SPACE_ID</span><span class=\"token operator\">:</span> spaceId<span class=\"token punctuation\">,</span>\n  <span class=\"token constant\">CONTENTFUL_USE_PREVIEW</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> usePreview <span class=\"token operator\">=</span> <span class=\"token constant\">CONTENTFUL_USE_PREVIEW</span> <span class=\"token operator\">===</span> <span class=\"token string\">'true'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> host <span class=\"token operator\">=</span> usePreview\n  <span class=\"token operator\">?</span> <span class=\"token string\">'preview.contentful.com'</span>\n  <span class=\"token comment\">// If `null`, defaults to the Delivery API </span>\n  <span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> accessToken <span class=\"token operator\">=</span> usePreview\n  <span class=\"token comment\">// The Preview API uses a different token than the Delivery API</span>\n  <span class=\"token operator\">?</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">CONTENTFUL_PREVIEW_TOKEN</span>\n  <span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">CONTENTFUL_DELIVERY_TOKEN</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>spaceId <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>accessToken<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">'Contentful spaceId and access token need to be provided'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  spaceId<span class=\"token punctuation\">,</span>\n  host<span class=\"token punctuation\">,</span>\n  accessToken<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Then, pass them to the plugin as options:</p>\n<p><code class=\"language-text\">gatsby-config.js</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> contentfulOptions <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./contentful-options'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token operator\">...</span>\nplugins<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n  resolve<span class=\"token operator\">:</span> <span class=\"token string\">'gatsby-source-contentful'</span><span class=\"token punctuation\">,</span>\n  options<span class=\"token operator\">:</span> contentfulOptions\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token operator\">...</span></code></pre></div>\n<h3 id=\"netlify\" style=\"position:relative;\"><a href=\"#netlify\" aria-label=\"netlify permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Netlify</h3>\n<p>Now, we need to setup Netlify to support authenticated builds using the Preview API.</p>\n<ol>\n<li>\n<p>Add the following environment variables:</p>\n<ul>\n<li><code class=\"language-text\">CONTENTFUL_PREVIEW_TOKEN</code> - Contentful API token</li>\n</ul>\n</li>\n<li>\n<p>Add a deploy context (<code class=\"language-text\">Site settings &gt; Build &amp; deploy &gt; Deploy Contexts</code>) for the target branch, e.g. <code class=\"language-text\">develop</code></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; margin: 1rem; max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/538d81c70415213f32006f6058c5191b/077d3/branch-deploys.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.21621621621622%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA+0lEQVQoz31Sa0/DMAzs//9rfEBCCFhXFAbT1nXtRp5tyeOIk7Xa0Kil01mOdXHOKbgQODQN6uaI3b7Gj7WgCCEkKKWxrw+wse69XwT1F9Q4jGPGMMSDMAtSuNjIuYDSOkNlyAvrWBNSJpBogTsxiVEY06NiDG13yhc4d4PpJROKv4VZ7JLTrd+cpwlM30MbkyalnJjOr2NxQh/54ViDbbdgbIPVusJbucbLqkRZveO1rLCL/lK/tS7ZsyhIPHo3e0SeEdMipVIQQiamqaVUKb8reL1lCnpy07Y4nc9xCSafI8x84+GS2CTYdh0en57x8fkFGxdBvrl/vs4vGhJxGwzSXLcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Deploy Contenxt\"\n        title=\"Deploy Contenxt\"\n        src=\"/static/538d81c70415213f32006f6058c5191b/6d370/branch-deploys.png\"\n        srcset=\"/static/538d81c70415213f32006f6058c5191b/c5084/branch-deploys.png 148w,\n/static/538d81c70415213f32006f6058c5191b/60cc9/branch-deploys.png 295w,\n/static/538d81c70415213f32006f6058c5191b/6d370/branch-deploys.png 590w,\n/static/538d81c70415213f32006f6058c5191b/077d3/branch-deploys.png 631w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n</li>\n<li>\n<p>Update your build settings via <code class=\"language-text\">netlify.toml</code> to use authentication and the preview API</p>\n<p><code class=\"language-text\">netlify.toml</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># Settings for `develop` branch deploys.</span>\n<span class=\"token comment\"># If your target branch is named something else,</span>\n<span class=\"token comment\"># the context will be \"context.&lt;NAME>.environment\".</span>\n<span class=\"token punctuation\">[</span>context.develop.environment<span class=\"token punctuation\">]</span>\n  CONTENTFUL_USE_PREVIEW = \"true\"\n  ENABLE_NETLIFY_AUTH = \"true\"</code></pre></div>\n</li>\n<li>Enable Identity, add Google as a provider, and <strong>set it to invite-only</strong></li>\n<li>\n<p>Finally, add a build hook for the <code class=\"language-text\">develop</code> deploy context and copy it to your clipboard</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; margin: 1rem; max-width: 355px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fb99f928dbf79291198b713c158aa4c9/ed409/build-hook.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.2972972972973%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA20lEQVQoz52S2Q6CMBBF+/9/5YNRH5XVRKNGdhUo4IPQcu1UMCZuaJPTTqbNnfZOWdu2EEIqBKSUOqaV8o8MHYwXBeIkQZplyPK8gz8dJFEq9A1GU5rlCKMInh9gt/dUgQNyznXshyECtdc0zTBBqu4FARamBcNyMDdsLFdrcF7AcpcwbAem46JWgv1NP8GG+nPzV0DQ+gFWVhWiOMHxdNI+hlGM6nzWIn2jXjXp7Q0vdY2iLO+QWK1ysqsof0R7uNluMRpPMJ7OYNrug1f4ebD+7f23oG5qr/7kClezv4p+gpKhAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Build hook\"\n        title=\"Build hook\"\n        src=\"/static/fb99f928dbf79291198b713c158aa4c9/ed409/build-hook.png\"\n        srcset=\"/static/fb99f928dbf79291198b713c158aa4c9/c5084/build-hook.png 148w,\n/static/fb99f928dbf79291198b713c158aa4c9/60cc9/build-hook.png 295w,\n/static/fb99f928dbf79291198b713c158aa4c9/ed409/build-hook.png 355w\"\n        sizes=\"(max-width: 355px) 100vw, 355px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n</li>\n</ol>\n<h3 id=\"contentful\" style=\"position:relative;\"><a href=\"#contentful\" aria-label=\"contentful permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Contentful</h3>\n<p>Finally, we need to setup Contentful to trigger re-deploys of <code class=\"language-text\">develop</code> when content changes.</p>\n<p>Open the Webhooks for your environment and add the copied build hook.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; margin: 1rem; max-width: 579px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c8001183ae727e7f720450a0d76c9590/ff2d6/webhooks.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.108108108108105%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAAA2ElEQVQoz42RiwrCMAxF+/8fKCqKG8p0Puq6rutj4jWJHRsiaOGQR5feZFEhJYRIkPUxwocJyRPz3C+UNhamczDWwfnwfiALWOfRdn3OxT9IUI3t0eZC52PulB8c0PWB8EjDQ+L4AxZWRbFDXZ9QlgUSqch5PsX4EHBvWsG0VmhM9mkyfW8kHu/5KEcdcKHLnQyPiTRM6qP/LRdpKva5Ri2WK5T7A9abLQ7VUUZzvBCymtSr8xXH8w31VQuny43QQlVfJOZ7jnteCv+jOT4vZQ5/ODKPP33mBVxxHog9r2k3AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Webhooks\"\n        title=\"Webhooks\"\n        src=\"/static/c8001183ae727e7f720450a0d76c9590/ff2d6/webhooks.png\"\n        srcset=\"/static/c8001183ae727e7f720450a0d76c9590/c5084/webhooks.png 148w,\n/static/c8001183ae727e7f720450a0d76c9590/60cc9/webhooks.png 295w,\n/static/c8001183ae727e7f720450a0d76c9590/ff2d6/webhooks.png 579w\"\n        sizes=\"(max-width: 579px) 100vw, 579px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>We can add linking from content to the preview website:</p>\n<ol>\n<li>Open <code class=\"language-text\">Content Preview</code> for your environment</li>\n<li>Select the content you want</li>\n<li>\n<p>Use the full Netlify URL for the preview URLs</p>\n<ul>\n<li>e.g. <code class=\"language-text\">https://develop--projectname.netlify.com/blog/{entry.fields.slug}</code></li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; margin: 1rem; max-width: 515px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/dc999e06c0b6058c5eb750bb2b362119/70021/content-preview-urls.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.32432432432432%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABCElEQVQoz61Sa0/DMAzs//+BoKzp0oy1Y0grzavd+sjhGDViEh8YYOlky3ZOl1yK8XpFCIExjiO89wjDAOscpmlCBBBj/DGKtj1BVoqwhz68oJQV56dngculw6NRZFWkcCBlCam39R0pNdbmHec8jDHc3+aW5htYodjtoOoaWmtIKRlCCFRVRYolyrIk1QfUtKOU4jqRfSXKhPRCWJYF/xXFNC9oSOWxaZn4EQO+NaXuIurjGU3ToKe3+U3cEd5uE30RnxEGMiMMcD5wTjDWc05zY12uE1K9rCtWIlspM2FPS4kgHXRM4Bjbod7YPO/eTSbuzefeHeE8z3g9v5HLmhzd05ewf7ryB+I7CHrfx3hDAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Content Preview URLs\"\n        title=\"Content Preview URLs\"\n        src=\"/static/dc999e06c0b6058c5eb750bb2b362119/70021/content-preview-urls.png\"\n        srcset=\"/static/dc999e06c0b6058c5eb750bb2b362119/c5084/content-preview-urls.png 148w,\n/static/dc999e06c0b6058c5eb750bb2b362119/60cc9/content-preview-urls.png 295w,\n/static/dc999e06c0b6058c5eb750bb2b362119/70021/content-preview-urls.png 515w\"\n        sizes=\"(max-width: 515px) 100vw, 515px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n</li>\n</ol>\n<p>Then, a preview button will show up for creators on the right-side pane when creating content such as blog posts.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; margin: 1rem; max-width: 334px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/61a03906c1012e3a4d10bc7a3df704eb/ce235/preview-button.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34.45945945945946%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAAAyElEQVQoz51Qyw6CMBDk/z/OGA1RUEBeKiCRV2nBw9itllSJxniYzG63M52t1fYcjAt0vUAvBvBh/Bukt8I0R5qViI45qpapQ3qAEf8KPkxhLJWODAzWdfc2M+czaENKVXUGZN+wXonpOwgN41Ndy9knjTKMswJJfpmQFiXcQ4yF7cDeB9gGkeqJN14IPzkhkXdMTSQ9zuUVYry9GsbaMEywdj0JHyvHU8bEy80OjjRPvxlS5PoZXTOt+FhZTKvrP2xkPdMYK98BPQQWeUjTXjsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Preview button\"\n        title=\"Preview button\"\n        src=\"/static/61a03906c1012e3a4d10bc7a3df704eb/ce235/preview-button.png\"\n        srcset=\"/static/61a03906c1012e3a4d10bc7a3df704eb/c5084/preview-button.png 148w,\n/static/61a03906c1012e3a4d10bc7a3df704eb/60cc9/preview-button.png 295w,\n/static/61a03906c1012e3a4d10bc7a3df704eb/ce235/preview-button.png 334w\"\n        sizes=\"(max-width: 334px) 100vw, 334px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"testing\" style=\"position:relative;\"><a href=\"#testing\" aria-label=\"testing permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Testing</h2>\n<p>To test the setup, push the changes to the <code class=\"language-text\">develop</code> branch after configuring Contentful and Netlify. Upon a successful deploy, you should be redirected to the login page when accessing the website.</p>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p>Questions? E-mail me.</p>","frontmatter":{"date":"April 21, 2019","path":"/blog/auth-preview-gatsby-contentful-netlify","title":"Creating an authenticated preview site for Gatsby and Contentful using Netlify Identity"},"excerpt":"Learn how to setup a preview instance of your Gatsby site using the Contentful Preview API\nand authenticate it using Netlify Identity with Google OAuth."}},"pageContext":{"prevPost":{"title":"Scraping 10 Years of Github User/Dev Data","postPath":"/blog/scraping-10-yrs-github"},"nextPost":{"title":"Notion + GTD","postPath":"/blog/gtd-notion"}}}}